#!/usr/bin/env zsh

# Usage e.g.:
# brew_log_summary              # --- Current month
# brew_log_summary 2025-06      # --- June 2025
brew_log_summary() {
    local logdir="$BREWDOTS/logs"
    local month="${1:-$(date +%Y-%m)}"
    local file="$logdir/brew-activity-${month}.log"

    [[ ! -f "$file" ]] && echo "âš ï¸ No log found for $month" && return

    echo "ğŸ“… Summary for $month:"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    grep -E 'brew (install|uninstall|upgrade|reinstall|tap|untap)' "$file" \
        | awk '{print $2, $3, $4, $5}' \
        | sort | uniq -c | sort -nr
}

# clear_brew_logs() {
#     : > "$BREWDOTS/logs/brew-activity.log" && echo "âœ… Cleared brew logs."
# }
clear_brew_logs() {
    local ts=$(date +%Y-%m-%d_%H-%M-%S)
    local log="$BREWDOTS/logs/brew-activity.log"
    [[ -f $log ]] && cp "$log" "$log.backup-$ts"
    : > "$log"
    echo "ğŸ“¦ Archived and cleared brew logs ($ts)"
}

ls_with_git() {
  for item in *; do
    if [ -d "$item" ]; then
      if [ -d "$item/.git" ]; then
        echo "ğŸ“‚ $item (git repo)"
        git -C "$item" status --short
      else
        echo "ğŸ“ $item"
      fi
    else
      echo "ğŸ“„ $item"
    fi
  done
}
